<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é­‚æ°£çµ±è¨ˆè¨ˆç®—æ©Ÿ (å®Œæ•´å„²å­˜ç‰ˆ)</title>
    <style>
        :root { --choco: #5d4037; --accent: #ff9800; --bg: #fdfaf6; --blue: #0277bd; }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background-color: var(--bg); display: flex; justify-content: center; padding: 20px; color: #333; }
        .container { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 450px; }
        
        /* å·§å…‹åŠ›è¼¸å…¥å€ */
        .header { background: var(--choco); color: white; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 20px; }
        .header label { font-size: 0.9rem; opacity: 0.9; display: block; margin-bottom: 5px; }
        .choco-input { background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); color: #ffccbc; font-size: 2rem; font-weight: bold; text-align: center; width: 85%; border-radius: 10px; outline: none; }

        /* é­‚æ°£æ–¹å¡Š */
        .soul-box { display: flex; justify-content: space-between; align-items: center; padding: 12px 18px; border: 2px solid #eee; border-radius: 12px; margin-bottom: 10px; cursor: pointer; transition: 0.2s; }
        .soul-box:hover { border-color: var(--accent); background: #fffcf5; }
        .soul-box:active { transform: scale(0.97); }
        .count-tag { background: var(--accent); color: white; padding: 2px 12px; border-radius: 10px; font-weight: bold; }

        /* çµ±è¨ˆå€å¡Š */
        .stats-panel { margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 15px; border-left: 5px solid var(--blue); }
        .stats-title { font-weight: bold; margin-bottom: 10px; display: block; color: var(--blue); font-size: 1.1rem; }
        .stat-line { display: flex; justify-content: space-between; font-size: 0.95rem; margin-bottom: 6px; }
        .probability { color: var(--blue); font-weight: bold; }
        
        .total-info { border-top: 2px solid #dee2e6; margin-top: 12px; padding-top: 12px; }
        .highlight-total { font-size: 1.2rem; color: #d32f2f; font-weight: bold; }

        /* åŠŸèƒ½æŒ‰éˆ• */
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .btn { padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-reset { background: #e0e0e0; color: #666; }
        .btn-clear { background: #ff5252; color: white; }
        .btn:hover { opacity: 0.8; }
    </style>
</head>
<body onload="loadData()">

<div class="container">
    <div class="header">
        <label>ğŸ« å‰©é¤˜å·§å…‹åŠ›ç¸½æ•¸ (å¯é»æ“Šä¿®æ”¹)ï¼š</label>
        <input type="number" id="chocoInput" class="choco-input" value="100" onchange="saveData()">
    </div>

    <div id="soulContainer">
        <div class="soul-box" onclick="handleAction(500, 's500')">
            <span>é­‚æ°£ 500 <small>(æ‰£3ğŸ«)</small></span>
            <span class="count-tag" id="s500">0æ¬¡</span>
        </div>
        <div class="soul-box" onclick="handleAction(1000, 's1000')">
            <span>é­‚æ°£ 1000 <small>(æ‰£3ğŸ«)</small></span>
            <span class="count-tag" id="s1000">0æ¬¡</span>
        </div>
        <div class="soul-box" onclick="handleAction(2500, 's2500')">
            <span>é­‚æ°£ 2500 <small>(æ‰£3ğŸ«)</small></span>
            <span class="count-tag" id="s2500">0æ¬¡</span>
        </div>
        <div class="soul-box" onclick="handleAction(5000, 's5000')">
            <span>é­‚æ°£ 5000 <small>(æ‰£3ğŸ«)</small></span>
            <span class="count-tag" id="s5000">0æ¬¡</span>
        </div>
        <div class="soul-box" onclick="handleAction(10000, 's10000')">
            <span>é­‚æ°£ 10000 <small>(æ‰£3ğŸ«)</small></span>
            <span class="count-tag" id="s10000">0æ¬¡</span>
        </div>
    </div>

    <div class="stats-panel">
        <span class="stats-title">ğŸ“Š æ•¸æ“šåˆ†æèˆ‡æ©Ÿç‡</span>
        <div id="probList">
            <div class="stat-line">å°šæœªæœ‰é»æ“Šç´€éŒ„</div>
        </div>
        
        <div class="total-info">
            <div class="stat-line">ç¸½é»æ“Šæ¬¡æ•¸ï¼š<span id="totalClicks" style="font-weight:bold;">0</span> æ¬¡</div>
            <div class="stat-line">
                <span>ç´¯è¨ˆé­‚æ°£ç¸½é‡ï¼š</span>
                <span id="totalSoulSum" class="highlight-total">0</span>
            </div>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn btn-reset" onclick="resetCountsOnly()">åƒ…æ¬¡æ•¸æ­¸é›¶</button>
        <button class="btn btn-clear" onclick="clearAllData()">å…¨éƒ¨é‡è¨­(å«å·§å…‹åŠ›)</button>
    </div>
</div>

<script>
    // é è¨­ç‹€æ…‹
    let state = {
        choco: 100,
        totalClicks: 0,
        totalSoulSum: 0,
        counts: { 500: 0, 1000: 0, 2500: 0, 5000: 0, 10000: 0 }
    };

    // è™•ç†æ–¹å¡Šé»æ“Š
    function handleAction(soulValue, id) {
        const inputField = document.getElementById('chocoInput');
        state.choco = parseInt(inputField.value) || 0;

        if (state.choco >= 3) {
            // é‹ç®—é‚è¼¯
            state.choco -= 3;
            state.totalClicks++;
            state.totalSoulSum += soulValue;
            state.counts[soulValue]++;
            
            // æ›´æ–°ä¸¦å„²å­˜
            updateUI();
            saveData();
        } else {
            alert("å·§å…‹åŠ›ä¸è¶³ï¼é»æ“Šéœ€è¦ 3 é¡†å·§å…‹åŠ›ã€‚");
        }
    }

    // æ›´æ–°ä»‹é¢
    function updateUI() {
        document.getElementById('chocoInput').value = state.choco;
        document.getElementById('totalClicks').innerText = state.totalClicks;
        document.getElementById('totalSoulSum').innerText = state.totalSoulSum.toLocaleString(); // åŠ ä¸Šåƒåˆ†ä½ç¬¦è™Ÿ

        const probList = document.getElementById('probList');
        probList.innerHTML = "";

        for (let key in state.counts) {
            // æ›´æ–°æ–¹å¡Šä¸Šçš„æ¬¡æ•¸
            document.getElementById('s' + key).innerText = state.counts[key] + "æ¬¡";
            
            // æ›´æ–°æ©Ÿç‡åˆ—è¡¨
            let percent = state.totalClicks > 0 ? ((state.counts[key] / state.totalClicks) * 100).toFixed(1) : 0;
            probList.innerHTML += `
                <div class="stat-line">
                    <span>é­‚æ°£ ${key}ï¼š</span>
                    <span class="probability">${percent}%</span>
                </div>`;
        }
    }

    // å„²å­˜è³‡æ–™
    function saveData() {
        state.choco = parseInt(document.getElementById('chocoInput').value) || 0;
        localStorage.setItem('gameSoulData_v2', JSON.stringify(state));
    }

    // è®€å–è³‡æ–™
    function loadData() {
        const saved = localStorage.getItem('gameSoulData_v2');
        if (saved) {
            state = JSON.parse(saved);
            updateUI();
        }
    }

    // åƒ…æ­¸é›¶è¨ˆæ•¸å™¨ (ä¿ç•™å·§å…‹åŠ›é¤˜é¡)
    function resetCountsOnly() {
        if(confirm("ç¢ºå®šè¦é‡è¨­æ‰€æœ‰çµ±è¨ˆæ¬¡æ•¸èˆ‡é­‚æ°£ç¸½å’Œå—ï¼Ÿ(æœƒä¿ç•™å·§å…‹åŠ›é¤˜é¡)")) {
            state.totalClicks = 0;
            state.totalSoulSum = 0;
            for(let key in state.counts) state.counts[key] = 0;
            updateUI();
            saveData();
        }
    }

    // å…¨éƒ¨é‡è¨­
    function clearAllData() {
        if (confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³‡æ–™(åŒ…å«å·§å…‹åŠ›)å—ï¼Ÿ")) {
            localStorage.removeItem('gameSoulData_v2');
            location.reload();
        }
    }
</script>

</body>
</html>